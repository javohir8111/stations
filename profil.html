<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RailSafe - Profil Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1e3a8a;
            --secondary: #3b82f6;
            --accent: #eab308;
            --background: #f3f4f6;
            --text: #111827;
            --card-bg: #ffffff;
            --border: #d1d5db;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            --status-success: #22c55e;
            --status-warning: #eab308;
            --status-danger: #ef4444;
        }

        [data-theme="dark"] {
            --primary: #f3f4f6;
            --secondary: #60a5fa;
            --background: #111827;
            --text: #f3f4f6;
            --card-bg: #1f2937;
            --border: #374151;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--text);
            margin: 0;
            transition: all 0.25s ease;
        }

        /* Back Button */
        .return-btn {
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 999;
            background: var(--card-bg);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 0.75rem 1.25rem;
            border-radius: 9999px;
            box-shadow: var(--shadow);
            transition: all 0.25s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .return-btn:hover {
            background: var(--secondary);
            color: white;
        }

        /* Profile Button */
        .profile-btn {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 999;
            background: var(--card-bg);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 0.75rem;
            border-radius: 50%;
            box-shadow: var(--shadow);
            transition: all 0.25s ease;
        }

        .profile-btn:hover {
            background: var(--secondary);
            color: white;
        }

        /* Main Container */
        .main-container {
            max-width: 1280px;
            margin: 4rem auto 2rem;
            padding: 0 1rem;
        }

        /* Panels */
        .panel {
            background: var(--card-bg);
            border-radius: 1rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: all 0.25s ease;
        }

        .panel:hover {
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .panel-title {
            background: var(--primary);
            color: white;
            padding: 1rem 1.5rem;
            font-weight: 600;
            font-size: 1.25rem;
        }

        .panel-content {
            padding: 1.5rem;
        }

        /* Profile Info */
        .profile-info {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        @media (min-width: 768px) {
            .profile-info {
                flex-direction: row;
            }
        }

        .avatar-wrap {
            text-align: center;
            flex-shrink: 0;
        }

        .avatar {
            width: 8rem;
            height: 8rem;
            border-radius: 50%;
            background: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: #6b7280;
            margin-bottom: 1rem;
        }

        .info-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border);
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-item i {
            color: var(--secondary);
            font-size: 1.25rem;
        }

        .info-item strong {
            min-width: 8rem;
        }

        .action-group {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        /* Permissions */
        .perms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(12rem, 1fr));
            gap: 1rem;
        }

        .perm-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            transition: all 0.25s ease;
        }

        .perm-item:hover {
            background: rgba(59, 130, 246, 0.05);
        }

        .perm-item i {
            font-size: 1.25rem;
        }

        /* Stats */
        .stats-layout {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(10rem, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .stat-block {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1.25rem;
            text-align: center;
            box-shadow: var(--shadow);
            transition: all 0.25s ease;
        }

        .stat-block:hover {
            transform: translateY(-0.25rem);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.8;
        }

        .graph-wrap {
            height: 20rem;
            background: linear-gradient(to bottom, var(--background), var(--card-bg));
            border-radius: 0.75rem;
            padding: 1rem;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        /* Activity Table */
        .history-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--background);
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .history-table th,
        .history-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .history-table th {
            background: var(--primary);
            color: white;
            font-weight: 600;
        }

        .history-table tr:hover {
            background: rgba(59, 130, 246, 0.05);
        }

        .status-tag {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
        }

        .status-success {
            background: rgba(34, 197, 94, 0.1);
            color: var(--status-success);
        }

        /* Settings */
        .config-group {
            margin: 2rem 0;
        }

        .config-panel {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
        }

        .config-title {
            color: var(--secondary);
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .lang-selector {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        .lang-option {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            background: var(--card-bg);
            color: var(--text);
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.25s ease;
        }

        .lang-option:hover,
        .lang-option.selected {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .theme-switch {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .switch-input {
            appearance: none;
            width: 3rem;
            height: 1.5rem;
            background: #9ca3af;
            border-radius: 9999px;
            position: relative;
            cursor: pointer;
            transition: all 0.25s ease;
        }

        .switch-input:checked {
            background: var(--status-success);
        }

        .switch-input::before {
            content: '';
            position: absolute;
            top: 0.125rem;
            left: 0.125rem;
            width: 1.25rem;
            height: 1.25rem;
            background: white;
            border-radius: 50%;
            transition: all 0.25s ease;
        }

        .switch-input:checked::before {
            transform: translateX(1.5rem);
        }

        .form-toggle {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .stats-layout {
                grid-template-columns: 1fr;
            }

            .perms-grid {
                grid-template-columns: 1fr;
            }

            .lang-selector {
                justify-content: center;
            }

            .action-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Back Button -->
    <button class="return-btn" onclick="navigateTo('stations.html')">
        <i class="fas fa-arrow-left"></i> Orqaga
    </button>

    <!-- Profile Button -->
    <button class="profile-btn" onclick="toggleDropdown()">
        <i class="fas fa-user"></i>
    </button>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Profile Area -->
        <div class="panel">
            <div class="panel-title">Shaxsiy Kabinet</div>
            <div class="panel-content">
                <div class="profile-info">
                    <div class="avatar-wrap">
                        <div class="avatar">ðŸ‘¤</div>
                        <button class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#avatarEditModal">
                            <i class="fas fa-camera"></i> Rasm O'zgartirish
                        </button>
                    </div>
                    <div class="flex-grow-1">
                        <ul class="info-list">
                            <li class="info-item">
                                <i class="fas fa-user"></i>
                                <strong>Ism:</strong> <span id="userName">Irgashev Abdulla</span>
                            </li>
                            <li class="info-item">
                                <i class="fas fa-briefcase"></i>
                                <strong>Lavozim:</strong> <span id="userRole">Tarmoq Administratori</span>
                            </li>
                            <li class="info-item">
                                <i class="fas fa-building"></i>
                                <strong>Bo'lim:</strong> <span id="userDept">Texnik Bo'lim</span>
                            </li>
                            <li class="info-item">
                                <i class="fas fa-phone"></i>
                                <strong>Telefon:</strong> <span id="userPhone">+998 90 123 45 67</span>
                            </li>
                            <li class="info-item">
                                <i class="fas fa-envelope"></i>
                                <strong>Email:</strong> <span id="userEmail">irgashev@example.com</span>
                            </li>
                            <li class="info-item">
                                <i class="fas fa-calendar-alt"></i>
                                <strong>Qo'shilgan sana:</strong> <span id="userJoin">2020-01-15</span>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="action-group">
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#profileEditModal">
                        <i class="fas fa-edit"></i> Tahrirlash
                    </button>
                    <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#passChangeModal">
                        <i class="fas fa-lock"></i> Parol O'zgartirish
                    </button>
                </div>
            </div>
        </div>

        <!-- Permissions -->
        <div class="panel">
            <div class="panel-title">Ruxsatlar</div>
            <div class="panel-content">
                <div class="perms-grid">
                    <div class="perm-item">
                        <i class="fas fa-eye text-success"></i> Stansiyalarni Ko'rish
                    </div>
                    <div class="perm-item">
                        <i class="fas fa-bell text-warning"></i> Ogohlantirish Boshqaruv
                    </div>
                    <div class="perm-item">
                        <i class="fas fa-file-export text-info"></i> Hisobot Eksport
                    </div>
                    <div class="perm-item">
                        <i class="fas fa-cog text-primary"></i> Sozlamalar O'zgartirish
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats -->
        <div class="panel">
            <div class="panel-title">Statistika</div>
            <div class="panel-content">
                <div class="stats-layout">
                    <div class="stat-block">
                        <div class="stat-value">1,247</div>
                        <div class="stat-label">Tekshirilganlar</div>
                    </div>
                    <div class="stat-block">
                        <div class="stat-value">89</div>
                        <div class="stat-label">Hal Qilinganlar</div>
                    </div>
                    <div class="stat-block">
                        <div class="stat-value">156</div>
                        <div class="stat-label">Hisobotlar</div>
                    </div>
                    <div class="stat-block">
                        <div class="stat-value">99.2%</div>
                        <div class="stat-label">Samaradorlik</div>
                    </div>
                </div>
                <div class="graph-wrap">
                    <canvas id="statsGraph"></canvas>
                </div>
            </div>
        </div>

        <!-- History -->
        <div class="panel">
            <div class="panel-title">Tarix</div>
            <div class="panel-content">
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>Sana</th>
                            <th>Amal</th>
                            <th>Tafsilot</th>
                            <th>Holati</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>2025-12-10</td>
                            <td>Tekshiruv</td>
                            <td>Kattakurgan</td>
                            <td><span class="status-tag status-success">OK</span></td>
                        </tr>
                        <tr>
                            <td>2025-12-09</td>
                            <td>Hal Qilish</td>
                            <td>Sensor Xatosi</td>
                            <td><span class="status-tag status-success">OK</span></td>
                        </tr>
                        <tr>
                            <td>2025-12-08</td>
                            <td>Hisobot</td>
                            <td>Oylik</td>
                            <td><span class="status-tag status-success">OK</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Config Area -->
        <div class="config-group">
            <div class="config-panel">
                <h4 class="config-title">Umumiy Sozlamalar</h4>
                <div>
                    <label>Til Tanlash</label>
                    <div class="lang-selector">
                        <button class="lang-option selected" data-lang="uz" onclick="changeLang('uz')">UZB</button>
                        <button class="lang-option" data-lang="ru" onclick="changeLang('ru')">RUS</button>
                        <button class="lang-option" data-lang="en" onclick="changeLang('en')">ENG</button>
                    </div>
                </div>
                <div class="theme-switch">
                    <span>Qorong'i Rejim</span>
                    <input type="checkbox" class="switch-input" id="darkModeSwitch" onchange="switchTheme()">
                </div>
                <div class="form-toggle">
                    <input type="checkbox" id="emailAlerts" checked>
                    <label for="emailAlerts">Email Ogohlantirishlar</label>
                </div>
                <div class="form-toggle">
                    <input type="checkbox" id="smsAlerts">
                    <label for="smsAlerts">SMS Ogohlantirishlar</label>
                </div>
                <div class="form-toggle">
                    <input type="checkbox" id="autoGenReports">
                    <label for="autoGenReports">Avto Hisobotlar</label>
                </div>
            </div>
            <div class="config-panel">
                <h4 class="config-title">Xavfsizlik</h4>
                <div class="form-toggle">
                    <input type="checkbox" id="twoFA">
                    <label for="twoFA">2FA</label>
                </div>
                <div class="form-toggle">
                    <input type="checkbox" id="loginNotify" checked>
                    <label for="loginNotify">Kirish Ogohlantirish</label>
                </div>
                <button class="btn btn-danger mt-2" data-bs-toggle="modal" data-bs-target="#accountDeleteModal">
                    <i class="fas fa-trash"></i> Akkaunt O'chirish
                </button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Profile Edit -->
    <div class="modal fade" id="profileEditModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Profil Tahriri</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Yopish"></button>
                </div>
                <div class="modal-body">
                    <form id="profileForm">
                        <div class="mb-3">
                            <label for="editUserName" class="form-label">Ism</label>
                            <input type="text" class="form-control" id="editUserName" value="Irgashev Abdulla" required>
                        </div>
                        <div class="mb-3">
                            <label for="editUserRole" class="form-label">Lavozim</label>
                            <input type="text" class="form-control" id="editUserRole" value="Tarmoq Administratori" required>
                        </div>
                        <div class="mb-3">
                            <label for="editUserPhone" class="form-label">Telefon</label>
                            <input type="tel" class="form-control" id="editUserPhone" value="+998 90 123 45 67" required pattern="[+][0-9]{3} [0-9]{2} [0-9]{3} [0-9]{2} [0-9]{2}">
                        </div>
                        <div class="mb-3">
                            <label for="editUserEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="editUserEmail" value="irgashev@example.com" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Yopish</button>
                    <button type="button" class="btn btn-primary" onclick="updateProfile()">Saqlash</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Password Change -->
    <div class="modal fade" id="passChangeModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Parol O'zgartirish</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Yopish"></button>
                </div>
                <div class="modal-body">
                    <form id="passForm">
                        <div class="mb-3">
                            <label for="oldPass" class="form-label">Eski Parol</label>
                            <input type="password" class="form-control" id="oldPass" required minlength="8">
                        </div>
                        <div class="mb-3">
                            <label for="newPass" class="form-label">Yangi Parol</label>
                            <input type="password" class="form-control" id="newPass" required minlength="8">
                        </div>
                        <div class="mb-3">
                            <label for="confirmNewPass" class="form-label">Tasdiqlash</label>
                            <input type="password" class="form-control" id="confirmNewPass" required minlength="8">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Yopish</button>
                    <button type="button" class="btn btn-primary" onclick="updatePassword()">Saqlash</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Avatar Edit -->
    <div class="modal fade" id="avatarEditModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Avatar O'zgartirish</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Yopish"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <div style="width: 10rem; height: 10rem; border-radius: 50%; background: #e5e7eb; margin: 0 auto; display: flex; align-items: center; justify-content: center; font-size: 5rem; color: #6b7280;">
                            ðŸ‘¤
                        </div>
                    </div>
                    <div class="mb-3">
                        <input type="file" class="form-control" id="avatarFile" accept="image/*">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Yopish</button>
                    <button type="button" class="btn btn-primary" onclick="updateAvatar()">Saqlash</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Account Delete -->
    <div class="modal fade" id="accountDeleteModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Akkaunt O'chirish</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Yopish"></button>
                </div>
                <div class="modal-body">
                    <p>O'chirishni tasdiqlang. Bu qaytarilmaydi.</p>
                    <div class="form-toggle">
                        <input type="checkbox" id="deleteConfirm">
                        <label for="deleteConfirm">Tasdiqlayman</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Yopish</button>
                    <button type="button" class="btn btn-danger" onclick="removeAccount()">O'chirish</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script>
        // Theme Switch
        function switchTheme() {
            const isDark = document.documentElement.dataset.theme === 'dark';
            document.documentElement.dataset.theme = isDark ? 'light' : 'dark';
            localStorage.setItem('appTheme', document.documentElement.dataset.theme);
        }

        // Language Change
        function changeLang(lang) {
            document.querySelectorAll('.lang-option').forEach(btn => btn.classList.remove('selected'));
            document.querySelector(`.lang-option[data-lang="${lang}"]`).classList.add('selected');
            localStorage.setItem('appLang', lang);
        }

        // Chart Init
        function setupGraph() {
            const ctx = document.getElementById('statsGraph').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Faollik',
                        data: [10, 20, 15, 25, 18, 30],
                        borderColor: 'rgba(59, 130, 246, 1)',
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        // Profile Update
        function updateProfile() {
            const form = document.getElementById('profileForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            document.getElementById('userName').textContent = document.getElementById('editUserName').value;
            document.getElementById('userRole').textContent = document.getElementById('editUserRole').value;
            document.getElementById('userPhone').textContent = document.getElementById('editUserPhone').value;
            document.getElementById('userEmail').textContent = document.getElementById('editUserEmail').value;
            bootstrap.Modal.getInstance(document.getElementById('profileEditModal')).hide();
        }

        // Password Update
        function updatePassword() {
            const form = document.getElementById('passForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            const newPass = document.getElementById('newPass').value;
            const confirm = document.getElementById('confirmNewPass').value;
            if (newPass !== confirm) {
                alert('Parollar mos emas!');
                return;
            }
            alert('Parol o\'zgartirildi!');
            bootstrap.Modal.getInstance(document.getElementById('passChangeModal')).hide();
        }

        // Avatar Update
        function updateAvatar() {
            const file = document.getElementById('avatarFile').files[0];
            if (file) {
                alert('Avatar saqlandi!');
            }
            bootstrap.Modal.getInstance(document.getElementById('avatarEditModal')).hide();
        }

        // Account Remove
        function removeAccount() {
            if (!document.getElementById('deleteConfirm').checked) {
                alert('Tasdiqlang!');
                return;
            }
            alert('Akkaunt o\'chirildi!');
            localStorage.clear();
            navigateTo('index.html');
        }

        // Navigation
        function navigateTo(url) {
            window.location.href = url;
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            const theme = localStorage.getItem('appTheme') || 'light';
            document.documentElement.dataset.theme = theme;
            document.getElementById('darkModeSwitch').checked = theme === 'dark';

            const lang = localStorage.getItem('appLang') || 'uz';
            changeLang(lang);

            setupGraph();
        });
    </script>
</body>
</html>
